<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ domain }} - DNS Tool</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="fas fa-globe me-2"></i>DNS Tool <span class="badge bg-secondary ms-1">v{{ app_version }}</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('history') }}">
                            <i class="fas fa-history me-1"></i>History
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('stats') }}">
                            <i class="fas fa-chart-bar me-1"></i>Statistics
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-1">DNS Analysis Results</h1>
                <div class="text-muted">
                    <strong>{{ domain }}</strong>
                    {% if ascii_domain != domain %}
                        <span class="badge bg-secondary ms-2">ASCII: {{ ascii_domain }}</span>
                    {% endif %}
                </div>
            </div>
            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>New Analysis
            </a>
        </div>
        
        <!-- Global Posture Score -->
        {% if results.posture %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-{{ results.posture.color }} bg-{{ results.posture.color }} bg-opacity-10">
                    <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between flex-wrap">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-{{ results.posture.icon }} fa-2x text-{{ results.posture.color }} me-3"></i>
                                <div>
                                    <div class="d-flex align-items-center">
                                        <span class="text-muted small me-2">DNS & Trust Posture:</span>
                                        <span class="badge bg-{{ results.posture.color }} fs-6 px-3 py-2">{{ results.posture.state }}</span>
                                    </div>
                                    <small class="text-muted">{{ results.posture.message }}</small>
                                </div>
                            </div>
                            {% if results.posture.issues or results.posture.monitoring %}
                            <div class="mt-2 mt-md-0">
                                {% if results.posture.issues %}
                                    <small class="text-danger d-block"><i class="fas fa-times-circle me-1"></i>{{ results.posture.issues|length }} issue{{ 's' if results.posture.issues|length > 1 else '' }}</small>
                                {% endif %}
                                {% if results.posture.monitoring %}
                                    <small class="text-info d-block"><i class="fas fa-eye me-1"></i>{{ results.posture.monitoring|length }} monitoring</small>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Domain Summary Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-primary border-opacity-25 bg-primary bg-opacity-10">
                    <div class="card-body py-3">
                        <div class="row align-items-center">
                            <div class="col-md-3 border-end border-primary border-opacity-10">
                                <small class="text-uppercase text-muted fw-bold d-block" style="font-size: 0.7rem;">Registrar <span class="text-info">({{ results.registrar_info.source|upper if results.registrar_info.source else '?' }})</span></small>
                                <div class="text-truncate" title="{{ results.registrar_info.registrar or 'Unknown' }}">
                                    <i class="fas fa-id-card text-primary me-2"></i>
                                    <strong>{{ results.registrar_info.registrar.split('(')[0].strip() if results.registrar_info.registrar else 'Unknown' }}</strong>
                                </div>
                                <small class="text-muted d-block" style="font-size: 0.65rem;">Where you pay to own domain</small>
                            </div>
                            <div class="col-md-3 border-end border-primary border-opacity-10">
                                <small class="text-uppercase text-muted fw-bold d-block" style="font-size: 0.7rem;">Email Service Provider</small>
                                <div class="text-truncate">
                                    <i class="fas fa-envelope text-primary me-2"></i>
                                    <strong>{{ results.hosting_summary.email_hosting if results.hosting_summary and results.hosting_summary.email_hosting else 'Unknown' }}</strong>
                                </div>
                                <small class="text-muted d-block" style="font-size: 0.65rem;">Where email is hosted (MX)</small>
                            </div>
                            <div class="col-md-3 border-end border-primary border-opacity-10">
                                <small class="text-uppercase text-muted fw-bold d-block" style="font-size: 0.7rem;">Web Hosting</small>
                                <div class="text-truncate">
                                    <i class="fas fa-server text-primary me-2"></i>
                                    <strong>{{ results.hosting_summary.hosting if results.hosting_summary else 'Unknown' }}</strong>
                                </div>
                                <small class="text-muted d-block" style="font-size: 0.65rem;">Where website is hosted</small>
                            </div>
                            <div class="col-md-3">
                                <small class="text-uppercase text-muted fw-bold d-block" style="font-size: 0.7rem;">DNS Hosting</small>
                                <div class="text-truncate">
                                    <i class="fas fa-network-wired text-primary me-2"></i>
                                    <strong>{{ results.hosting_summary.dns_hosting if results.hosting_summary else 'Standard' }}</strong>
                                </div>
                                <small class="text-muted d-block" style="font-size: 0.65rem;">Where DNS records are edited</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Email Security Section -->
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0 d-flex align-items-center justify-content-between flex-wrap">
                            <span><i class="fas fa-shield-alt me-2"></i>Email Security</span>
                            <small class="text-muted">Can this domain be impersonated by email?
                                {% if results.posture and results.posture.verdicts.email_answer %}
                                    <span class="badge bg-{{ 'success' if results.posture.verdicts.email_answer == 'No' else 'warning' if 'Mostly' in results.posture.verdicts.email_answer or 'Partially' in results.posture.verdicts.email_answer else 'danger' }} ms-1">{{ results.posture.verdicts.email_answer }}</span>
                                {% endif %}
                            </small>
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if results.posture and results.posture.verdicts.email %}
                            <div class="alert alert-{{ 'success' if results.posture.verdicts.email_answer == 'No' else 'warning' if 'Mostly' in results.posture.verdicts.email_answer or 'Partially' in results.posture.verdicts.email_answer else 'danger' }} py-2 mb-3 small">
                                <i class="fas fa-gavel me-2"></i><strong>Verdict:</strong> {{ results.posture.verdicts.email }}
                            </div>
                        {% endif %}
                        <div class="row">
                            <!-- SPF Analysis -->
                            <div class="col-md-4 mb-3 mb-md-0">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-envelope me-2"></i>SPF Record
                                    <span class="badge bg-{{ 'success' if results.spf_analysis.status == 'success' else 'danger' if results.spf_analysis.status == 'error' else 'warning' }} ms-2">
                                        {{ results.spf_analysis.status|title }}
                                    </span>
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.spf_analysis.message }}</p>
                                {% if results.spf_analysis.valid_records %}
                                    {% for record in results.spf_analysis.valid_records %}
                                        <div class="code-block small">{{ record }}</div>
                                    {% endfor %}
                                {% endif %}
                                {% if results.spf_analysis.spf_like %}
                                    <div class="mt-2 p-2 bg-danger bg-opacity-10 border border-danger rounded">
                                        <small class="text-danger d-block fw-bold">
                                            <i class="fas fa-exclamation-circle me-1"></i>
                                            Duplicate SPF records found!
                                        </small>
                                        <small class="text-muted d-block">Only one SPF record is allowed per domain. Multiple records can cause delivery issues.</small>
                                        {% for record in results.spf_analysis.spf_like %}
                                            <div class="code-block small mt-1 border-danger text-danger">{{ record }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- DMARC Analysis -->
                            <div class="col-md-4 mb-3 mb-md-0">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-lock me-2"></i>DMARC Policy
                                    <span class="badge bg-{{ 'success' if results.dmarc_analysis.status == 'success' else 'danger' if results.dmarc_analysis.status == 'error' else 'warning' }} ms-2">
                                        {{ results.dmarc_analysis.status|title }}
                                    </span>
                                    {% if results.dmarc_analysis.policy %}
                                        <span class="badge bg-{{ 'success' if results.dmarc_analysis.policy == 'reject' else 'warning' if results.dmarc_analysis.policy == 'quarantine' else 'secondary' }} ms-1">{{ results.dmarc_analysis.policy|upper }}</span>
                                    {% endif %}
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.dmarc_analysis.message }}</p>
                                {% if results.dmarc_analysis.valid_records %}
                                    {% for record in results.dmarc_analysis.valid_records %}
                                        <div class="code-block small">{{ record }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>

                            <!-- DKIM Analysis -->
                            <div class="col-md-4">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-key me-2"></i>DKIM Records
                                    <span class="badge bg-{{ 'success' if results.dkim_analysis.status == 'success' else 'warning' }} ms-2">
                                        {{ results.dkim_analysis.status|title }}
                                    </span>
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.dkim_analysis.message }}</p>
                                {% if results.dkim_analysis.selectors %}
                                    {% for selector, records in results.dkim_analysis.selectors.items() %}
                                        <div class="mb-2">
                                            <small class="text-success d-block">
                                                <i class="fas fa-check-circle me-1"></i>{{ selector }}
                                            </small>
                                            {% for record in records %}
                                                <div class="code-block small mt-1" style="word-break: break-all;">{{ record }}</div>
                                            {% endfor %}
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Second Row: MTA-STS and TLS-RPT -->
                        <div class="row mt-4 pt-3 border-top">
                            <!-- MTA-STS Analysis -->
                            <div class="col-md-6 mb-3 mb-md-0">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-shield-alt me-2"></i>MTA-STS
                                    <span class="badge bg-{{ 'success' if results.mta_sts_analysis.status == 'success' else 'warning' }} ms-2">
                                        {{ results.mta_sts_analysis.status|title }}
                                    </span>
                                    {% if results.mta_sts_analysis.mode %}
                                        <span class="badge bg-{{ 'success' if results.mta_sts_analysis.mode == 'enforce' else 'warning' }} ms-1">{{ results.mta_sts_analysis.mode|upper }}</span>
                                    {% endif %}
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.mta_sts_analysis.message }}</p>
                                {% if results.mta_sts_analysis.record %}
                                    <div class="code-block small">{{ results.mta_sts_analysis.record }}</div>
                                {% endif %}
                            </div>

                            <!-- TLS-RPT Analysis -->
                            <div class="col-md-6">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-file-alt me-2"></i>TLS-RPT
                                    <span class="badge bg-{{ 'success' if results.tlsrpt_analysis.status == 'success' else 'warning' }} ms-2">
                                        {{ results.tlsrpt_analysis.status|title }}
                                    </span>
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.tlsrpt_analysis.message }}</p>
                                {% if results.tlsrpt_analysis.record %}
                                    <div class="code-block small">{{ results.tlsrpt_analysis.record }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Brand Security Section -->
        <div class="row">
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0 d-flex align-items-center justify-content-between flex-wrap">
                            <span><i class="fas fa-certificate me-2"></i>Brand Security</span>
                            <small class="text-muted">Can my brand be convincingly faked?</small>
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if results.posture and results.posture.verdicts.brand %}
                            <div class="alert alert-{{ 'success' if results.posture.verdicts.brand_secure else 'warning' }} py-2 mb-3 small">
                                <i class="fas fa-gavel me-2"></i><strong>Verdict:</strong> {{ results.posture.verdicts.brand }}
                            </div>
                        {% endif %}
                        <div class="row">
                            <!-- BIMI Analysis -->
                            <div class="col-md-6 mb-3 mb-md-0">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-image me-2"></i>BIMI (Brand Logo)
                                    <span class="badge bg-{{ 'success' if results.bimi_analysis.status == 'success' else 'warning' }} ms-2">
                                        {{ results.bimi_analysis.status|title }}
                                    </span>
                                    {% if results.bimi_analysis.vmc_url %}
                                        <span class="badge bg-success ms-1">VMC</span>
                                    {% elif results.bimi_analysis.logo_url %}
                                        <span class="badge bg-info ms-1">No VMC</span>
                                    {% endif %}
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.bimi_analysis.message }}</p>
                                {% if results.bimi_analysis.status == 'success' and not results.bimi_analysis.vmc_url %}
                                    <div class="small text-info mb-2">
                                        <i class="fas fa-info-circle me-1"></i>
                                        BIMI works without VMC! VMC (Verified Mark Certificate) requires a registered trademark. Small businesses can use BIMI with just a logo - it shows in Apple Mail and some providers. Gmail requires VMC.
                                    </div>
                                {% elif results.bimi_analysis.vmc_url %}
                                    <div class="small text-success mb-2">
                                        <i class="fas fa-check-circle me-1"></i>
                                        VMC verified - logo displays in Gmail, Apple Mail, and all major providers.
                                    </div>
                                {% endif %}
                                {% if results.bimi_analysis.record %}
                                    <div class="code-block small">{{ results.bimi_analysis.record }}</div>
                                {% endif %}
                                {% if results.bimi_analysis.logo_url %}
                                    <div class="mt-3 d-flex align-items-center">
                                        <div class="me-3 p-2 bg-white rounded" style="flex-shrink: 0;">
                                            <img src="{{ results.bimi_analysis.logo_url }}" 
                                                 alt="BIMI Logo" 
                                                 style="width: 48px; height: 48px; object-fit: contain;"
                                                 onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2248%22 height=%2248%22><rect fill=%22%23e5e7eb%22 width=%2248%22 height=%2248%22 rx=%224%22/><text x=%2224%22 y=%2230%22 text-anchor=%22middle%22 fill=%22%239ca3af%22 font-size=%2212%22>SVG</text></svg>'">
                                        </div>
                                        <div class="small">
                                            <span class="text-success"><i class="fas fa-check-circle me-1"></i>Logo found</span>
                                            <a href="{{ results.bimi_analysis.logo_url }}" target="_blank" class="d-block text-info text-truncate" style="max-width: 200px;" title="{{ results.bimi_analysis.logo_url }}">
                                                <i class="fas fa-external-link-alt me-1"></i>View full logo
                                            </a>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>

                            <!-- CAA Analysis -->
                            <div class="col-md-6">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-lock me-2"></i>CAA (Certificate Authority)
                                    <span class="badge bg-{{ 'success' if results.caa_analysis.status == 'success' else 'warning' }} ms-2">
                                        {{ results.caa_analysis.status|title }}
                                    </span>
                                    {% if results.caa_analysis.has_iodef %}
                                        <span class="badge bg-info ms-1">IODEF</span>
                                    {% endif %}
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.caa_analysis.message }}</p>
                                {% if results.caa_analysis.issuers %}
                                    <div class="mb-2">
                                        <small class="text-muted">Authorized CAs:</small>
                                        {% for issuer in results.caa_analysis.issuers %}
                                            <span class="badge bg-primary ms-1">{{ issuer }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if results.caa_analysis.records %}
                                    {% for record in results.caa_analysis.records %}
                                        <div class="code-block small mb-1">{{ record }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Domain Security Section (DNSSEC + NS Delegation) -->
        <div class="row">
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0 d-flex align-items-center justify-content-between flex-wrap">
                            <span><i class="fas fa-shield-alt me-2"></i>Domain Security</span>
                            <small class="text-muted">Can DNS itself be tampered with?</small>
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if results.posture and results.posture.verdicts.domain %}
                            <div class="alert alert-{{ 'success' if 'authenticated' in results.posture.verdicts.domain else 'warning' }} py-2 mb-3 small">
                                <i class="fas fa-gavel me-2"></i><strong>Verdict:</strong> {{ results.posture.verdicts.domain }}
                            </div>
                        {% endif %}
                        <div class="row">
                            <!-- DNSSEC Analysis -->
                            <div class="col-md-6 mb-3 mb-md-0">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-key me-2"></i>DNSSEC
                                    <span class="badge bg-{{ 'success' if results.dnssec_analysis.status == 'success' else 'warning' }} ms-2">
                                        {{ 'Signed' if results.dnssec_analysis.status == 'success' else 'Unsigned' }}
                                    </span>
                                    {% if results.dnssec_analysis.algorithm_name %}
                                        <span class="badge bg-info ms-1">{{ results.dnssec_analysis.algorithm_name }}</span>
                                    {% endif %}
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.dnssec_analysis.message }}</p>
                                
                                {% if results.dnssec_analysis.status == 'success' %}
                                    <div class="small text-success mb-2">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Chain of trust: Root → TLD → Domain. DNS responses are authenticated and tamper-proof.
                                    </div>
                                {% elif results.dnssec_analysis.chain_of_trust == 'broken' %}
                                    <div class="small text-warning mb-2">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        DNSKEY exists but DS record not published at registrar. Add DS record to complete chain of trust.
                                    </div>
                                {% else %}
                                    <div class="small text-info mb-2">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Without DNSSEC, DNS responses can be spoofed. Enable at your DNS provider for cryptographic verification.
                                    </div>
                                {% endif %}
                                
                                {% if results.dnssec_analysis.ds_records %}
                                    <div class="mt-2">
                                        <small class="text-muted d-block mb-1">DS Record (at registrar):</small>
                                        {% for ds in results.dnssec_analysis.ds_records %}
                                            <div class="code-block small mb-1" style="font-size: 0.7rem;">{{ ds }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- NS Delegation Analysis -->
                            <div class="col-md-6">
                                <h6 class="d-flex align-items-center">
                                    <i class="fas fa-project-diagram me-2"></i>NS Delegation
                                    <span class="badge bg-{{ 'success' if results.ns_delegation_analysis.status == 'success' else 'warning' if results.ns_delegation_analysis.status == 'warning' else 'secondary' }} ms-2">
                                        {{ 'Verified' if results.ns_delegation_analysis.delegation_ok else 'Check Failed' }}
                                    </span>
                                    {% if results.ns_delegation_analysis.match == true %}
                                        <span class="badge bg-success ms-1">Match</span>
                                    {% elif results.ns_delegation_analysis.match == false %}
                                        <span class="badge bg-warning ms-1">Mismatch</span>
                                    {% endif %}
                                </h6>
                                <p class="text-muted mb-2 small">{{ results.ns_delegation_analysis.message }}</p>
                                
                                {% if results.ns_delegation_analysis.match == false %}
                                    <div class="small text-warning mb-2">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        NS records at domain differ from parent zone delegation. May indicate recent DNS migration still propagating.
                                    </div>
                                {% elif results.ns_delegation_analysis.match == true %}
                                    <div class="small text-success mb-2">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Parent zone delegation matches domain's NS records. No delegation drift detected.
                                    </div>
                                {% endif %}
                                
                                {% if results.ns_delegation_analysis.child_ns %}
                                    <div class="mt-2">
                                        <small class="text-muted d-block mb-1">Nameservers:</small>
                                        {% for ns in results.ns_delegation_analysis.child_ns %}
                                            <span class="badge bg-secondary me-1 mb-1">{{ ns }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Traffic & Routing Section -->
        <div class="row">
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-route me-2"></i>Traffic & Routing
                            <small class="text-muted ms-2">Where traffic flows &amp; how services resolve</small>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- A Records (IPv4) -->
                            <div class="col-md-3 mb-3">
                                <h6 class="d-flex align-items-center">
                                    <span class="badge bg-primary me-2">A</span>IPv4 Address
                                </h6>
                                {% if results.basic_records.A %}
                                    {% for record in results.basic_records.A %}
                                        <div class="code-block small mb-1">{{ record }}</div>
                                    {% endfor %}
                                    <small class="text-muted">Where the domain points for web traffic</small>
                                {% else %}
                                    <div class="text-muted small"><i class="fas fa-minus me-1"></i>No A records</div>
                                    <small class="text-info">Domain may use AAAA (IPv6) only or CNAME</small>
                                {% endif %}
                            </div>

                            <!-- AAAA Records (IPv6) -->
                            <div class="col-md-3 mb-3">
                                <h6 class="d-flex align-items-center">
                                    <span class="badge bg-info me-2">AAAA</span>IPv6 Address
                                </h6>
                                {% if results.basic_records.AAAA %}
                                    {% for record in results.basic_records.AAAA %}
                                        <div class="code-block small mb-1">{{ record }}</div>
                                    {% endfor %}
                                    <small class="text-success"><i class="fas fa-check me-1"></i>IPv6 ready</small>
                                {% else %}
                                    <div class="text-muted small"><i class="fas fa-minus me-1"></i>No AAAA records</div>
                                    <small class="text-muted">IPv6 not configured</small>
                                {% endif %}
                            </div>

                            <!-- MX Records (Mail) -->
                            <div class="col-md-3 mb-3">
                                <h6 class="d-flex align-items-center">
                                    <span class="badge bg-warning text-dark me-2">MX</span>Mail Servers
                                </h6>
                                {% if results.basic_records.MX %}
                                    {% for record in results.basic_records.MX %}
                                        <div class="code-block small mb-1">{{ record }}</div>
                                    {% endfor %}
                                    <small class="text-muted">Priority + mail server for email delivery</small>
                                {% else %}
                                    <div class="text-muted small"><i class="fas fa-minus me-1"></i>No MX records</div>
                                    <small class="text-warning">Domain cannot receive email</small>
                                {% endif %}
                            </div>

                            <!-- SRV Records (Services) -->
                            <div class="col-md-3 mb-3">
                                <h6 class="d-flex align-items-center">
                                    <span class="badge bg-secondary me-2">SRV</span>Services
                                </h6>
                                {% if results.basic_records.SRV %}
                                    {% for record in results.basic_records.SRV %}
                                        <div class="code-block small mb-1">{{ record }}</div>
                                    {% endfor %}
                                    <small class="text-muted">SIP, XMPP, or other service endpoints</small>
                                {% else %}
                                    <div class="text-muted small"><i class="fas fa-minus me-1"></i>No SRV records</div>
                                    <small class="text-muted">No service-specific routing configured</small>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Summary bar -->
                        <div class="border-top pt-3 mt-2">
                            <div class="d-flex flex-wrap gap-3 small">
                                <span>
                                    <i class="fas fa-globe me-1 text-primary"></i>
                                    <strong>Web:</strong>
                                    {% if results.basic_records.A or results.basic_records.AAAA %}
                                        <span class="text-success">Reachable</span>
                                        ({{ results.basic_records.A|length if results.basic_records.A else 0 }} IPv4, {{ results.basic_records.AAAA|length if results.basic_records.AAAA else 0 }} IPv6)
                                    {% else %}
                                        <span class="text-warning">No direct IP</span>
                                    {% endif %}
                                </span>
                                <span>
                                    <i class="fas fa-envelope me-1 text-warning"></i>
                                    <strong>Mail:</strong>
                                    {% if results.basic_records.MX %}
                                        <span class="text-success">{{ results.basic_records.MX|length }} server{{ 's' if results.basic_records.MX|length > 1 else '' }}</span>
                                    {% else %}
                                        <span class="text-danger">Not configured</span>
                                    {% endif %}
                                </span>
                                <span>
                                    <i class="fas fa-cogs me-1 text-secondary"></i>
                                    <strong>Services:</strong>
                                    {% if results.basic_records.SRV %}
                                        <span class="text-success">{{ results.basic_records.SRV|length }} endpoint{{ 's' if results.basic_records.SRV|length > 1 else '' }}</span>
                                    {% else %}
                                        <span class="text-muted">None</span>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Propagation Delta Summary -->
        {% set propagating_types = [] %}
        {% set synced_count = 0 %}
        {% if results.propagation_status %}
            {% for rtype, pinfo in results.propagation_status.items() %}
                {% if pinfo.status == 'propagating' %}
                    {% set _ = propagating_types.append(rtype) %}
                {% elif pinfo.status == 'synchronized' %}
                    {% set synced_count = synced_count + 1 %}
                {% endif %}
            {% endfor %}
        {% endif %}
        
        <div class="row mb-3">
            <div class="col-12">
                {% if propagating_types %}
                <div class="alert alert-warning py-2 mb-0 d-flex align-items-center justify-content-between flex-wrap">
                    <div>
                        <i class="fas fa-sync-alt fa-spin me-2"></i>
                        <strong>Δ Changes Detected:</strong>
                        {% for rtype in propagating_types %}
                            <span class="badge bg-warning text-dark ms-1">{{ rtype }}</span>
                        {% endfor %}
                        <span class="ms-2 small text-muted">Resolver ≠ Authoritative (TTL / CDN rotation / recent change)</span>
                    </div>
                    <small class="text-warning-emphasis">
                        <i class="fas fa-clock me-1"></i>Risk: Low - typically resolves within TTL
                    </small>
                </div>
                {% else %}
                <div class="alert alert-success py-2 mb-0 d-flex align-items-center">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Δ No Propagation Issues:</strong>
                    <span class="ms-2 small">All DNS records are synchronized between resolver and authoritative nameserver.</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- DNS Records Section -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-database me-2"></i>Evidence: Resolver Records
                            <small class="text-muted ms-2">(Raw DNS data)</small>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for record_type, records in results.basic_records.items() %}
                                <div class="col-12 mb-3">
                                    <h6 class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <span class="badge bg-secondary me-2">{{ record_type }}</span>
                                            {% if records %}
                                                <small class="text-success">{{ records|length }} record{{ 's' if records|length > 1 else '' }}</small>
                                            {% else %}
                                                <small class="text-muted">No records</small>
                                            {% endif %}
                                        </div>
                                        
                                        {% if results.propagation_status and record_type in results.propagation_status %}
                                            {% set p_info = results.propagation_status[record_type] %}
                                            {% if p_info.status == 'synchronized' %}
                                                <span class="badge bg-success-subtle text-success border border-success-subtle px-2 py-1" style="font-size: 0.65rem;">
                                                    <i class="fas fa-check-double me-1"></i>Synchronized
                                                </span>
                                            {% elif p_info.status == 'propagating' %}
                                                <span class="badge bg-warning-subtle text-warning border border-warning-subtle px-2 py-1" style="font-size: 0.65rem;" title="Public resolver does not match authoritative nameserver">
                                                    <i class="fas fa-clock me-1"></i>Still Propagating
                                                </span>
                                            {% endif %}
                                        {% endif %}
                                    </h6>
                                    {% if records %}
                                        {% for record in records %}
                                            <div class="code-block">{{ record }}</div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="text-muted small">
                                            <i class="fas fa-minus me-1"></i>No records found
                                        </div>
                                        {% if record_type == 'CNAME' %}
                                            <div class="text-info small mt-1">
                                                <i class="fas fa-lightbulb me-1"></i>Tip: CNAMEs are usually on subdomains. Try searching <strong>www.{{ domain }}</strong> or another subdomain.
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-primary bg-opacity-10">
                        <h5 class="mb-0">
                            <i class="fas fa-microchip me-2"></i>Evidence: Authoritative Records
                            <small class="text-muted ms-2">(Direct from nameserver)</small>
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if results.authoritative_records and results.authoritative_records.values()|map('length')|sum > 0 %}
                            <div class="row">
                                {% for record_type, records in results.authoritative_records.items() %}
                                    <div class="col-12 mb-3">
                                        <h6 class="d-flex align-items-center">
                                            <span class="badge bg-primary me-2">{{ record_type }}</span>
                                            {% if records %}
                                                <small class="text-success">{{ records|length }} record{{ 's' if records|length > 1 else '' }}</small>
                                            {% else %}
                                                <small class="text-muted">No records</small>
                                            {% endif %}
                                        </h6>
                                        {% if records %}
                                            {% for record in records %}
                                                <div class="code-block border-primary border-opacity-25">{{ record }}</div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="text-muted small">
                                                <i class="fas fa-minus me-1"></i>No records found
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-5 text-muted">
                                <i class="fas fa-satellite-dish fa-3x mb-3 opacity-25"></i>
                                <p>No authoritative records could be retrieved directly.</p>
                                <small>This may happen if the nameservers are blocking direct queries or timing out.</small>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Back to top -->
        <div class="text-center mt-4">
            <a href="{{ url_for('index') }}" class="btn btn-primary">
                <i class="fas fa-search me-2"></i>Analyze Another Domain
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
