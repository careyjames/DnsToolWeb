<!DOCTYPE html>
{{htmlComment " You found one. There are more. View source is a valid attack vector against boredom. "}}
<html lang="en" data-bs-theme="dark">
<head>
    {{template "head" .}}
    {{template "head_css" .}}
    <title>System Architecture - DNS Tool</title>
    <meta name="robots" content="index, follow">
    <meta name="description" content="Interactive architecture diagrams of DNS Tool's intelligence engines, request lifecycle, and package structure.">
    <meta property="og:url" content="https://dnstool.it-help.tech/architecture">
    <meta property="og:type" content="website">
    <meta property="og:title" content="System Architecture - DNS Tool">
    <meta property="og:description" content="Interactive architecture diagrams of DNS Tool's intelligence engines, request lifecycle, and package structure.">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="System Architecture - DNS Tool">
    <meta name="twitter:description" content="Interactive architecture diagrams of DNS Tool's intelligence engines, request lifecycle, and package structure.">
    <style nonce="{{.CspNonce}}">
        .arch-diagram-card {
            background: linear-gradient(145deg, #0c1018 0%, #111720 50%, #0e141c 100%);
            border: 1px solid rgba(88,166,255,0.2) !important;
            border-radius: 14px;
            overflow: hidden;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .arch-diagram-card:hover {
            border-color: rgba(88,166,255,0.4) !important;
            box-shadow: 0 8px 32px rgba(88,166,255,0.1), 0 0 0 1px rgba(88,166,255,0.05);
        }
        .arch-diagram-header {
            background: linear-gradient(90deg, rgba(88,166,255,0.1) 0%, rgba(63,185,80,0.05) 60%, transparent 100%);
            border-bottom: 1px solid rgba(88,166,255,0.12) !important;
            padding: 1rem 1.5rem;
        }
        .arch-diagram-body {
            padding: 2.5rem 2rem;
            overflow-x: auto;
        }
        .arch-diagram-body svg {
            max-width: 100%;
            height: auto;
        }

        .mermaid svg .cluster rect {
            fill: rgba(88,166,255,0.10) !important;
            stroke: rgba(88,166,255,0.45) !important;
            stroke-width: 2px !important;
            rx: 8 !important;
        }

        .mermaid svg .cluster .nodeLabel,
        .mermaid svg .cluster text,
        .mermaid svg .cluster span {
            color: #79c0ff !important;
            fill: #79c0ff !important;
            font-weight: bold !important;
        }

        .mermaid svg .edgePath path.path {
            stroke: #58a6ff !important;
            stroke-width: 1.5px !important;
        }

        .mermaid svg .edgeLabel rect {
            fill: #0d1117 !important;
            opacity: 1 !important;
            rx: 4 !important;
            ry: 4 !important;
        }

        .mermaid svg .edgeLabel span,
        .mermaid svg .edgeLabel .label {
            color: #a5d6ff !important;
            fill: #a5d6ff !important;
        }

        .mermaid svg marker path {
            fill: #58a6ff !important;
            stroke: #58a6ff !important;
        }

        .mermaid svg .node .label,
        .mermaid svg .node .nodeLabel,
        .mermaid svg .nodeLabel {
            color: #ffffff !important;
            fill: #ffffff !important;
        }

        .mermaid svg .node foreignObject div,
        .mermaid svg .node foreignObject span,
        .mermaid svg .nodeLabel div,
        .mermaid svg .nodeLabel span {
            color: #ffffff !important;
        }

        .arch-main-container {
            max-width: 1500px;
        }
        .arch-diagram-title {
            color: #e6edf3;
        }
        .arch-diagram-icon {
            color: #58a6ff;
        }
    </style>
</head>
<body class="bg-dark text-light">
    {{template "nav" .}}
    <main class="container-fluid px-3 px-md-5 py-3 arch-main-container" id="main-content">
        {{range .Diagrams}}
        <div class="card arch-diagram-card border-0 mb-5">
            <div class="arch-diagram-header">
                <h5 class="mb-0 fw-semibold d-flex align-items-center arch-diagram-title">
                    <i class="fas fa-sitemap me-2 arch-diagram-icon"></i>{{.Title}}
                </h5>
            </div>
            <div class="arch-diagram-body text-center">
                <pre class="mermaid">{{.Content}}</pre>
            </div>
        </div>
        {{end}}

        {{/* INTENTIONAL: 50% opacity is a deliberate design choice â€” community signal for curious engineers. Do NOT increase opacity, remove, or "fix" this element. It is not a bug. */}}
        <p class="text-center text-muted small mt-4 mb-1 u-opacity-50"><i class="fas fa-terminal me-1"></i>Hackers who read source code sometimes find things others don't.</p>
        <div class="text-center mt-2 mb-3">
            <a href="https://github.com/careyjames/dns-tool-web" target="_blank" rel="noopener" class="btn btn-outline-secondary btn-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" class="me-1 u-valign-n3" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>View Source on GitHub
            </a>
        </div>
    </main>
    {{template "footer" .}}
    {{template "scripts" .}}
    <script nonce="{{.CspNonce}}" src="{{staticVersionURL "js/mermaid.min.js" .AppVersion}}"></script>
    <script nonce="{{.CspNonce}}">
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                background: 'transparent',
                fontFamily: '"Segoe UI", system-ui, -apple-system, sans-serif',
                fontSize: '14px',
                primaryColor: '#2563eb',
                primaryBorderColor: '#60a5fa',
                primaryTextColor: '#ffffff',
                secondaryColor: '#16a34a',
                secondaryBorderColor: '#4ade80',
                secondaryTextColor: '#ffffff',
                tertiaryColor: '#9333ea',
                tertiaryBorderColor: '#c084fc',
                tertiaryTextColor: '#ffffff',
                lineColor: '#58a6ff',
                textColor: '#ffffff',
                mainBkg: '#2563eb',
                nodeBorder: '#60a5fa',
                nodeTextColor: '#ffffff',
                clusterBkg: 'rgba(88,166,255,0.12)',
                clusterBorder: 'rgba(88,166,255,0.5)',
                titleColor: '#79c0ff',
                edgeLabelBackground: '#161b22',
                labelTextColor: '#e6edf3'
            },
            flowchart: {
                htmlLabels: true,
                curve: 'linear',
                padding: 20,
                nodeSpacing: 80,
                rankSpacing: 80,
                diagramPadding: 20,
                useMaxWidth: true
            }
        });

        var colorMap = {
            engine:   {fill:'#2563eb', stroke:'#60a5fa'},
            storage:  {fill:'#16a34a', stroke:'#4ade80'},
            external: {fill:'#9333ea', stroke:'#c084fc'},
            client:   {fill:'#0891b2', stroke:'#22d3ee'},
            app:      {fill:'#1d4ed8', stroke:'#60a5fa'},
            rfc:      {fill:'#2563eb', stroke:'#60a5fa'},
            gate:     {fill:'#ca8a04', stroke:'#facc15'},
            output:   {fill:'#16a34a', stroke:'#4ade80'},
            classify: {fill:'#0891b2', stroke:'#22d3ee'},
            input:    {fill:'#6366f1', stroke:'#a5b4fc'},
            maturity: {fill:'#2563eb', stroke:'#60a5fa'},
            cases:    {fill:'#0891b2', stroke:'#22d3ee'},
            'public': {fill:'#2563eb', stroke:'#60a5fa'},
            'private':{fill:'#9333ea', stroke:'#c084fc'},
            build:    {fill:'#16a34a', stroke:'#4ade80'},
            sync:     {fill:'#ca8a04', stroke:'#facc15'},
            safe:     {fill:'#16a34a', stroke:'#4ade80'},
            warn:     {fill:'#ca8a04', stroke:'#facc15'},
            danger:   {fill:'#dc2626', stroke:'#f87171'},
            check:    {fill:'#0891b2', stroke:'#22d3ee'},
            core:     {fill:'#2563eb', stroke:'#60a5fa'},
            infra:    {fill:'#9333ea', stroke:'#c084fc'}
        };
        var defaultColor = {fill:'#2563eb', stroke:'#60a5fa'};
        var classOrder = ['safe','warn','danger','check','engine','storage','external','client',
            'rfc','gate','output','classify','input','maturity','cases',
            'public','private','build','sync','core','infra','app'];

        function applyNodeColor(node) {
            var cls = node.getAttribute('class') || '';
            var color = null;
            for (var i = 0; i < classOrder.length; i++) {
                var re = new RegExp('\\b' + classOrder[i] + '\\b');
                if (re.test(cls)) {
                    color = colorMap[classOrder[i]];
                    break;
                }
            }
            if (!color) color = defaultColor;
            var shapes = node.querySelectorAll('rect, polygon, circle, ellipse');
            for (var j = 0; j < shapes.length; j++) {
                shapes[j].setAttribute('fill', color.fill);
                shapes[j].setAttribute('stroke', color.stroke);
                shapes[j].setAttribute('stroke-width', '2');
            }
            var paths = node.querySelectorAll('path');
            for (var k = 0; k < paths.length; k++) {
                var d = paths[k].getAttribute('d') || '';
                if (d.length > 10) {
                    paths[k].setAttribute('fill', color.fill);
                    paths[k].setAttribute('stroke', color.stroke);
                    paths[k].setAttribute('stroke-width', '2');
                }
            }
        }

        function applyTextColor(svg) {
            var labels = svg.querySelectorAll('.nodeLabel, .label text, .node text');
            for (var i = 0; i < labels.length; i++) {
                labels[i].setAttribute('fill', '#ffffff');
            }
            var foEls = svg.querySelectorAll('.nodeLabel div, .nodeLabel span, .node foreignObject div, .node foreignObject span');
            for (var j = 0; j < foEls.length; j++) {
                foEls[j].setAttribute('style', 'color:#ffffff !important');
            }
        }

        mermaid.run().then(function() {
            document.querySelectorAll('.mermaid svg').forEach(function(svg) {
                svg.querySelectorAll('.node').forEach(applyNodeColor);

                svg.querySelectorAll('.cluster rect').forEach(function(rect) {
                    rect.setAttribute('fill', 'rgba(88,166,255,0.10)');
                    rect.setAttribute('stroke', 'rgba(88,166,255,0.45)');
                    rect.setAttribute('stroke-width', '2');
                    rect.setAttribute('rx', '8');
                });

                svg.querySelectorAll('.cluster text, .cluster span').forEach(function(el) {
                    el.setAttribute('fill', '#79c0ff');
                });

                svg.querySelectorAll('.edgePath path, .flowchart-link, .edge-pattern-solid, .edge-pattern-dotted').forEach(function(p) {
                    p.setAttribute('stroke', '#58a6ff');
                    p.setAttribute('stroke-width', '1.5');
                    p.setAttribute('fill', 'none');
                });

                svg.querySelectorAll('marker path, marker polygon, marker circle').forEach(function(p) {
                    p.setAttribute('fill', '#58a6ff');
                    p.setAttribute('stroke', '#58a6ff');
                });

                svg.querySelectorAll('path[class*="edge"], line[class*="edge"]').forEach(function(p) {
                    p.setAttribute('stroke', '#58a6ff');
                    p.setAttribute('stroke-width', '1.5');
                    p.setAttribute('fill', 'none');
                });

                svg.querySelectorAll('.edgeLabel').forEach(function(label) {
                    var rects = label.querySelectorAll('rect');
                    rects.forEach(function(rect) {
                        rect.setAttribute('fill', '#0d1117');
                        rect.setAttribute('opacity', '1');
                        rect.setAttribute('rx', '4');
                        rect.setAttribute('ry', '4');
                        rect.setAttribute('stroke', '#30363d');
                        rect.setAttribute('stroke-width', '1');
                    });
                    var fo = label.querySelector('foreignObject');
                    if (fo && rects.length > 0) {
                        var foW = parseFloat(fo.getAttribute('width') || 0);
                        var foH = parseFloat(fo.getAttribute('height') || 0);
                        if (foW > 0 && foH > 0) {
                            rects[0].setAttribute('width', String(foW + 16));
                            rects[0].setAttribute('height', String(foH + 8));
                            rects[0].setAttribute('x', String(-((foW + 16) / 2)));
                            rects[0].setAttribute('y', String(-((foH + 8) / 2)));
                        }
                    }
                });

                applyTextColor(svg);
            });
        });
    </script>
</body>
</html>
