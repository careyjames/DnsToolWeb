<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    {{template "head" .}}
    <title>IP Investigation - DNS Tool</title>
    <meta name="description" content="Is this IP authorized to act on behalf of your domain? Correlates reverse DNS, ASN ownership, SPF records, and CT subdomain data for evidence-based attribution.">
    {{template "critical_css" .}}
    {{template "head_css" .}}
</head>
<body>
    {{template "nav" .}}
    <main id="main-content">

    {{if .ShowForm}}
    <section class="hero-section">
        <div class="container">
            <div class="text-center hero-content">
                <div class="hero-badge mb-3">
                    <i class="fas fa-route me-1"></i> IP Investigation
                    <span class="badge bg-warning text-dark ms-2" style="font-size: 0.65em; vertical-align: middle;">BETA</span>
                </div>
                <h1 class="hero-title mb-3">
                    IP Investigation
                </h1>
                <p class="hero-subtitle mx-auto mb-4" style="font-size: 1.35rem;">
                    Is this IP authorized to act on behalf of your domain?
                </p>
                <p class="text-muted mx-auto mb-4" style="max-width: 600px;">
                    Assess whether an IP address appears to be legitimate infrastructure, an approved service provider, or an external actor &mdash; based on DNS evidence in the context of your domain
                </p>
            </div>

            {{template "flash_messages" .}}

            <div class="row justify-content-center">
                <div class="col-lg-7 col-xl-6">
                    <div class="search-card">
                        <form method="POST" action="/investigate" id="investigateForm">
                            <input type="hidden" name="csrf_token" value="{{.CsrfToken}}">
                            <label for="domain" class="form-label search-label">
                                <i class="fas fa-globe me-2"></i>Your Domain
                            </label>
                            <div class="input-group input-group-lg search-input-group mb-3">
                                <input type="text"
                                       class="form-control search-input"
                                       id="domain"
                                       name="domain"
                                       placeholder="example.com"
                                       required
                                       autocomplete="off"
                                       aria-label="Domain to investigate against"
                                       value="{{.FormDomain}}">
                            </div>
                            <label for="ip_address" class="form-label search-label">
                                <i class="fas fa-network-wired me-2"></i>IP Address to Investigate
                            </label>
                            <div class="input-group input-group-lg search-input-group mb-3">
                                <input type="text"
                                       class="form-control search-input"
                                       id="ip_address"
                                       name="ip_address"
                                       placeholder="203.0.113.50 or 2001:db8::1"
                                       required
                                       autocomplete="off"
                                       aria-label="IP address to investigate"
                                       value="{{.FormIP}}">
                                <button class="btn btn-primary search-btn" type="submit" id="investigateBtn" aria-label="Investigate IP">
                                    <i class="fas fa-route me-2" aria-hidden="true"></i>Investigate
                                </button>
                            </div>
                            <div class="form-text search-hint mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                Enter a domain and an IP address from a report, log, or email header. We&rsquo;ll correlate reverse DNS, ASN ownership, SPF authorization, and infrastructure mapping &mdash; evidence-based attribution, not just a lookup.
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4 hero-trust">
                <span><i class="fas fa-globe me-1"></i> Reverse DNS + FCrDNS</span>
                <span class="trust-divider"></span>
                <span><i class="fas fa-network-wired me-1"></i> ASN Attribution</span>
                <span class="trust-divider"></span>
                <span><i class="fas fa-envelope me-1"></i> SPF Authorization Check</span>
                <span class="trust-divider"></span>
                <span><i class="fas fa-server me-1"></i> Infrastructure Mapping</span>
            </div>
        </div>
    </section>

    <div class="container">
        <section class="features-section">
            <h2 class="section-heading text-center mb-2">What We Check</h2>
            <p class="text-center text-muted mb-4">Cross-referencing the IP against every layer of your domain's infrastructure</p>
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card">
                        <div class="feature-card-icon feature-card-icon--primary">
                            <i class="fas fa-server"></i>
                        </div>
                        <h3 class="feature-card-title">DNS Records</h3>
                        <p class="feature-card-text">Compare against your domain's A, AAAA, MX, and NS records to identify direct hosting and service providers</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card">
                        <div class="feature-card-icon feature-card-icon--success">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h3 class="feature-card-title">SPF Authorization</h3>
                        <p class="feature-card-text">Check if the IP is authorized to send email on your behalf via SPF ip4/ip6 mechanisms and include chains</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card">
                        <div class="feature-card-icon feature-card-icon--info">
                            <i class="fas fa-building"></i>
                        </div>
                        <h3 class="feature-card-title">ASN &amp; Provider</h3>
                        <p class="feature-card-text">Identify the network operator, autonomous system, and whether the IP belongs to a CDN or cloud provider</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="feature-card">
                        <div class="feature-card-icon feature-card-icon--warning">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <h3 class="feature-card-title">CT Subdomains</h3>
                        <p class="feature-card-text">Cross-reference against Certificate Transparency discovered subdomains to find hidden infrastructure matches</p>
                    </div>
                </div>
            </div>
        </section>

        {{template "footer" .}}
    </div>
    {{end}}

    {{if .ShowResults}}
    <div class="container mt-4">
        <div class="d-flex align-items-center mb-4 flex-wrap gap-2">
            <h1 class="h3 mb-0">
                <i class="fas fa-route me-2 text-info"></i>IP Investigation Report
                <span class="badge bg-warning text-dark ms-2" style="font-size: 0.5em; vertical-align: middle;">BETA</span>
            </h1>
            <a href="/investigate" class="btn btn-outline-secondary btn-sm ms-auto">
                <i class="fas fa-search me-1"></i>New Investigation
            </a>
            <a href="/analyze?domain={{.AsciiDomain}}" class="btn btn-outline-info btn-sm">
                <i class="fas fa-shield-alt me-1"></i>Full Domain Audit
            </a>
        </div>

        {{$results := .Results}}
        {{$classification := mapGetStr "classification" $results}}
        {{$directCount := toInt (mapGet "direct_match_count" $results)}}
        {{$verdict := mapGetStr "executive_verdict" $results}}
        {{$verdictSev := mapGetStr "verdict_severity" $results}}
        {{$isCdn := mapGetBool "is_cdn" $results}}
        {{$cdnProv := mapGetStr "cdn_provider" $results}}

        <!-- ═══════════════════════════════════════════
             SECTION 1: Executive Verdict
             ═══════════════════════════════════════════ -->
        <div class="card mb-4 border-{{$verdictSev}}">
            <div class="card-body py-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="d-flex align-items-start">
                            <div class="me-3 mt-1">
                                {{if eq $verdictSev "success"}}
                                    <i class="fas fa-check-circle fa-2x text-success"></i>
                                {{else if eq $verdictSev "info"}}
                                    <i class="fas fa-circle-info fa-2x text-info"></i>
                                {{else if eq $verdictSev "warning"}}
                                    <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                                {{else if eq $verdictSev "primary"}}
                                    <i class="fas fa-globe fa-2x text-primary"></i>
                                {{else}}
                                    <i class="fas fa-circle-question fa-2x text-secondary"></i>
                                {{end}}
                            </div>
                            <div>
                                <h5 class="mb-1">
                                    <code class="text-light">{{.IPAddress}}</code>
                                    <i class="fas fa-long-arrow-alt-right mx-2 text-muted small"></i>
                                    <code class="text-light">{{.Domain}}</code>
                                </h5>
                                <div class="mt-2">
                                    {{if eq $classification "Unrelated"}}
                                        <span class="badge bg-secondary fs-6">No Relationship Found</span>
                                    {{else if or (eq $classification "Direct Asset (A Record)") (eq $classification "Direct Asset (AAAA Record)") (eq $classification "Direct Asset (Reverse DNS)")}}
                                        <span class="badge bg-success fs-6"><i class="fas fa-check-circle me-1"></i>{{$classification}}</span>
                                    {{else if eq $classification "Email Provider (MX)"}}
                                        <span class="badge bg-info fs-6"><i class="fas fa-envelope me-1"></i>{{$classification}}</span>
                                    {{else if eq $classification "DNS Provider (NS)"}}
                                        <span class="badge bg-primary fs-6"><i class="fas fa-server me-1"></i>{{$classification}}</span>
                                    {{else if or (eq $classification "SPF-Authorized Sender") (eq $classification "SPF-Authorized Sender (via include)")}}
                                        <span class="badge bg-warning text-dark fs-6"><i class="fas fa-paper-plane me-1"></i>{{$classification}}</span>
                                    {{else if eq $classification "CT Subdomain Match"}}
                                        <span class="badge bg-info fs-6"><i class="fas fa-certificate me-1"></i>{{$classification}}</span>
                                    {{else if eq $classification "CDN/Edge Network"}}
                                        <span class="badge bg-primary fs-6"><i class="fas fa-globe me-1"></i>{{$classification}}</span>
                                    {{else if eq $classification "Cloud Hosting"}}
                                        <span class="badge bg-info fs-6"><i class="fas fa-cloud me-1"></i>{{$classification}}</span>
                                    {{else}}
                                        <span class="badge bg-secondary fs-6">{{$classification}}</span>
                                    {{end}}
                                    <span class="badge bg-dark border border-secondary ms-2">{{mapGetStr "ip_version" $results}}</span>
                                </div>
                                <p class="mt-3 mb-0" style="color: #c9d1d9; font-size: 1.05rem;">{{$verdict}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        {{$asnInfo := mapGetMap "asn_info" $results}}
                        {{if $asnInfo}}
                            {{$asn := mapGetStr "asn" $asnInfo}}
                            {{$asName := mapGetStr "as_name" $asnInfo}}
                            {{$country := mapGetStr "country" $asnInfo}}
                            {{if ne $asn ""}}
                                <div class="small">
                                    <div class="text-muted"><strong>AS{{$asn}}</strong></div>
                                    {{if ne $asName ""}}<div class="text-muted">{{$asName}}</div>{{end}}
                                    {{if ne $country ""}}<div class="text-muted"><i class="fas fa-globe me-1"></i>{{$country}}</div>{{end}}
                                </div>
                            {{end}}
                        {{end}}
                    </div>
                </div>
            </div>
        </div>


        <!-- ═══════════════════════════════════════════
             SECTION 2: Network Identity
             ═══════════════════════════════════════════ -->
        {{$ptrSlice := toStringSlice (mapGet "ptr_records" $results)}}
        {{$fcrdns := mapGetBool "fcrdns_match" $results}}
        {{$asnInfoCard := mapGetMap "asn_info" $results}}

        <div class="card mb-4">
            <div class="card-header" style="background: linear-gradient(135deg, rgba(13, 110, 253, 0.15), rgba(13, 110, 253, 0.05)); border-bottom: 1px solid rgba(13, 110, 253, 0.2);">
                <h5 class="mb-0 d-flex align-items-center justify-content-between flex-wrap">
                    <span><i class="fas fa-id-card me-2" style="color: #58a6ff;"></i>Network Identity</span>
                    <small class="text-muted">Who owns this IP, and do they claim it publicly?
                        {{if and $ptrSlice (gt (len $ptrSlice) 0)}}
                            {{if $fcrdns}}
                                <span class="badge bg-success ms-1">Verified</span>
                            {{else}}
                                <span class="badge bg-warning ms-1">Unverified</span>
                            {{end}}
                        {{else}}
                            <span class="badge bg-secondary ms-1">No PTR</span>
                        {{end}}
                    </small>
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted small mb-3"><i class="fas fa-info-circle me-1"></i>Reverse DNS (PTR) is set by the IP owner; Forward-Confirmed (FCrDNS) proves the PTR name actually points back to this IP.</p>

                <div class="row">
                    <div class="col-lg-6 mb-3 mb-lg-0">
                        <p class="text-muted mb-2 fw-semibold"><i class="fas fa-globe me-1"></i>Reverse DNS (PTR)</p>
                        {{if and $ptrSlice (gt (len $ptrSlice) 0)}}
                            <table class="table table-dark table-sm mb-2">
                                <thead><tr><th>PTR Record</th><th>FCrDNS</th></tr></thead>
                                <tbody>
                                    {{range $ptrSlice}}
                                    <tr>
                                        <td><code>{{.}}</code></td>
                                        <td>
                                            {{if $fcrdns}}
                                                <span class="badge bg-success"><i class="fas fa-check me-1"></i>Confirmed</span>
                                            {{else}}
                                                <span class="badge bg-secondary"><i class="fas fa-minus me-1"></i>No match</span>
                                            {{end}}
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        {{else}}
                            <p class="text-muted small mb-0"><i class="fas fa-minus-circle me-1"></i>No PTR records found. The hosting provider may not have configured reverse DNS.</p>
                        {{end}}
                    </div>
                    <div class="col-lg-6">
                        <p class="text-muted mb-2 fw-semibold"><i class="fas fa-building me-1"></i>Network Operator</p>
                        {{if $asnInfoCard}}
                            <table class="table table-dark table-sm mb-2">
                                <tbody>
                                    {{$asn2 := mapGetStr "asn" $asnInfoCard}}
                                    {{if ne $asn2 ""}}
                                    <tr><th class="text-muted" style="width:35%">ASN</th><td><code>AS{{$asn2}}</code></td></tr>
                                    {{end}}
                                    {{$asName2 := mapGetStr "as_name" $asnInfoCard}}
                                    {{if ne $asName2 ""}}
                                    <tr><th class="text-muted">Organization</th><td>{{$asName2}}</td></tr>
                                    {{end}}
                                    {{$prefix := mapGetStr "prefix" $asnInfoCard}}
                                    {{if ne $prefix ""}}
                                    <tr><th class="text-muted">IP Prefix</th><td><code>{{$prefix}}</code></td></tr>
                                    {{end}}
                                    {{$country2 := mapGetStr "country" $asnInfoCard}}
                                    {{if ne $country2 ""}}
                                    <tr><th class="text-muted">Country</th><td>{{$country2}}</td></tr>
                                    {{end}}
                                </tbody>
                            </table>
                            {{if $isCdn}}
                                <div class="alert alert-info py-2 mb-0 small">
                                    <i class="fas fa-globe me-2"></i><strong>CDN/Edge Network:</strong> This IP belongs to <strong>{{$cdnProv}}</strong>'s global edge network. Traffic is proxied through shared infrastructure — this IP is not dedicated to any single customer.
                                </div>
                            {{else}}
                                {{$cloudProv := mapGetStr "cloud_provider" $results}}
                                {{if ne $cloudProv ""}}
                                <div class="alert alert-secondary py-2 mb-0 small">
                                    <i class="fas fa-cloud me-2"></i><strong>Cloud Hosting:</strong> This IP is hosted on <strong>{{$cloudProv}}</strong> cloud infrastructure. This is a standard cloud-hosted server, not a CDN edge node.
                                </div>
                                {{end}}
                            {{end}}
                        {{else}}
                            <p class="text-muted small mb-0">ASN information unavailable.</p>
                        {{end}}
                    </div>
                </div>
            </div>
        </div>


        <!-- ═══════════════════════════════════════════
             SECTION 3: Domain Relationship
             ═══════════════════════════════════════════ -->
        {{$directRels := toMapSlice (mapGet "direct_relationships" $results)}}

        <div class="card mb-4">
            <div class="card-header" style="background: linear-gradient(135deg, rgba(25, 135, 84, 0.15), rgba(25, 135, 84, 0.05)); border-bottom: 1px solid rgba(25, 135, 84, 0.2);">
                <h5 class="mb-0 d-flex align-items-center justify-content-between flex-wrap">
                    <span><i class="fas fa-project-diagram me-2" style="color: #3fb950;"></i>Domain Relationship</span>
                    <small class="text-muted">Does this IP serve or send for your domain?
                        {{if gt $directCount 0}}
                            <span class="badge bg-success ms-1">{{$directCount}} match{{if gt $directCount 1}}es{{end}}</span>
                        {{else}}
                            <span class="badge bg-secondary ms-1">No</span>
                        {{end}}
                    </small>
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted small mb-3"><i class="fas fa-info-circle me-1"></i>Checks A/AAAA (web hosting), MX (email), NS (DNS) records and SPF authorization to send email on your behalf.</p>

                {{if and $directRels (gt (len $directRels) 0)}}
                    <table class="table table-dark table-sm table-hover mb-0">
                        <thead>
                            <tr>
                                <th style="width: 25%">Role</th>
                                <th>Evidence</th>
                                <th style="width: 15%">Record</th>
                                <th style="width: 25%">Hostname</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range $directRels}}
                            <tr>
                                <td>
                                    {{$class := mapGetStr "classification" .}}
                                    {{if or (eq $class "Direct Asset (A Record)") (eq $class "Direct Asset (AAAA Record)") (eq $class "Direct Asset (Reverse DNS)")}}
                                        <span class="badge bg-success">{{$class}}</span>
                                    {{else if eq $class "Email Provider (MX)"}}
                                        <span class="badge bg-info">{{$class}}</span>
                                    {{else if eq $class "DNS Provider (NS)"}}
                                        <span class="badge bg-primary">{{$class}}</span>
                                    {{else if or (eq $class "SPF-Authorized Sender") (eq $class "SPF-Authorized Sender (via include)")}}
                                        <span class="badge bg-warning text-dark">{{$class}}</span>
                                    {{else}}
                                        <span class="badge bg-secondary">{{$class}}</span>
                                    {{end}}
                                </td>
                                <td class="small">{{mapGetStr "evidence" .}}</td>
                                <td><code>{{mapGetStr "record_type" .}}</code></td>
                                <td>
                                    {{$hostname := mapGetStr "hostname" .}}
                                    {{if ne $hostname ""}}<code>{{$hostname}}</code>{{else}}<span class="text-muted">&mdash;</span>{{end}}
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                {{else}}
                    <div class="text-center py-3">
                        <i class="fas fa-minus-circle text-muted mb-2 d-block" style="font-size: 1.5rem;"></i>
                        <p class="text-muted mb-1">This IP does not appear in <code>{{$.Domain}}</code>'s A, AAAA, MX, or NS records.</p>
                        <p class="text-muted small mb-0">It is also not authorized in the domain's SPF policy to send email.</p>
                    </div>
                {{end}}
            </div>
        </div>


        <!-- ═══════════════════════════════════════════
             SECTION 4: Infrastructure Context
             ═══════════════════════════════════════════ -->
        {{$infraRels := toMapSlice (mapGet "infra_context" $results)}}

        {{if and $infraRels (gt (len $infraRels) 0)}}
        <div class="card mb-4">
            <div class="card-header" style="background: linear-gradient(135deg, rgba(13, 202, 240, 0.15), rgba(13, 202, 240, 0.05)); border-bottom: 1px solid rgba(13, 202, 240, 0.2);">
                <h5 class="mb-0 d-flex align-items-center justify-content-between flex-wrap">
                    <span><i class="fas fa-server me-2" style="color: #58c4dc;"></i>Infrastructure Context</span>
                    <small class="text-muted">Is this IP part of your broader infrastructure?
                        {{$infraCount := len $infraRels}}
                        {{if gt $infraCount 0}}
                            <span class="badge bg-info ms-1">{{$infraCount}} signal{{if gt $infraCount 1}}s{{end}}</span>
                        {{else}}
                            <span class="badge bg-secondary ms-1">No</span>
                        {{end}}
                    </small>
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted small mb-3"><i class="fas fa-info-circle me-1"></i>CDN edge network membership and Certificate Transparency subdomain matches — infrastructure links beyond direct DNS records.</p>

                <table class="table table-dark table-sm table-hover mb-0">
                    <thead>
                        <tr>
                            <th style="width: 25%">Type</th>
                            <th>Evidence</th>
                            <th style="width: 15%">Source</th>
                            <th style="width: 25%">Hostname</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range $infraRels}}
                        <tr>
                            <td>
                                {{$class := mapGetStr "classification" .}}
                                {{if eq $class "CDN/Edge Network"}}
                                    <span class="badge bg-primary">{{$class}}</span>
                                {{else if eq $class "Cloud Hosting"}}
                                    <span class="badge bg-info"><i class="fas fa-cloud me-1"></i>{{$class}}</span>
                                {{else if eq $class "CT Subdomain Match"}}
                                    <span class="badge bg-info">{{$class}}</span>
                                {{else}}
                                    <span class="badge bg-secondary">{{$class}}</span>
                                {{end}}
                            </td>
                            <td class="small">{{mapGetStr "evidence" .}}</td>
                            <td><code>{{mapGetStr "record_type" .}}</code></td>
                            <td>
                                {{$hostname := mapGetStr "hostname" .}}
                                {{if ne $hostname ""}}<code>{{$hostname}}</code>{{else}}<span class="text-muted">&mdash;</span>{{end}}
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </div>
        {{end}}


        <!-- ═══════════════════════════════════════════
             SECTION 5: IP Neighborhood
             ═══════════════════════════════════════════ -->
        {{$neighborRels := toMapSlice (mapGet "neighborhood" $results)}}
        {{$neighborTotal := toInt (mapGet "neighborhood_total" $results)}}
        {{$neighborCtx := mapGetStr "neighborhood_context" $results}}

        {{if gt $neighborTotal 0}}
        <div class="card mb-4">
            <div class="card-header" style="background: linear-gradient(135deg, rgba(108, 117, 125, 0.15), rgba(108, 117, 125, 0.05)); border-bottom: 1px solid rgba(108, 117, 125, 0.3);">
                <h5 class="mb-0 d-flex align-items-center justify-content-between flex-wrap">
                    <span><i class="fas fa-building me-2" style="color: #8b949e;"></i>IP Neighborhood</span>
                    <small class="text-muted">Who else lives at this address?
                        <span class="badge bg-dark border border-secondary ms-1">{{$neighborTotal}} domain{{if gt $neighborTotal 1}}s{{end}}</span>
                    </small>
                </h5>
            </div>
            <div class="card-body">
                {{if ne $neighborCtx ""}}
                <div class="alert py-2 mb-3 small {{if $isCdn}}alert-warning{{else}}alert-secondary{{end}}">
                    <i class="fas fa-{{if $isCdn}}exclamation-triangle{{else}}info-circle{{end}} me-2"></i>{{$neighborCtx}}
                </div>
                {{end}}

                <p class="text-muted small mb-3"><i class="fas fa-info-circle me-1"></i>{{if $isCdn}}On CDN networks, thousands of unrelated websites share edge IPs — co-tenants, not affiliates.{{else}}On shared hosting, co-tenants may be worth reviewing for reputation. On dedicated hosting, these could indicate properties owned by the same organization.{{end}}</p>

                {{if and $neighborRels (gt (len $neighborRels) 0)}}
                    <table class="table table-dark table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Domain</th>
                                <th>Source</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range $neighborRels}}
                            <tr>
                                <td><code>{{mapGetStr "hostname" .}}</code></td>
                                <td><span class="badge bg-dark border border-secondary">SecurityTrails</span></td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                    {{if gt $neighborTotal 10}}
                    <p class="text-muted small mt-2 mb-0"><i class="fas fa-info-circle me-1"></i>Showing 10 of {{$neighborTotal}} domains. {{if $isCdn}}The remaining domains are additional {{$cdnProv}} customers sharing this edge node.{{else}}Additional domains omitted for brevity.{{end}}</p>
                    {{end}}
                {{end}}
            </div>
        </div>
        {{end}}


        <div class="text-center mb-5">
            <a href="/investigate" class="btn btn-outline-info me-2">
                <i class="fas fa-route me-1"></i>Investigate Another IP
            </a>
            <a href="/analyze?domain={{.AsciiDomain}}" class="btn btn-outline-primary">
                <i class="fas fa-shield-alt me-1"></i>Run Full Domain Audit on {{.Domain}}
            </a>
        </div>

        {{template "footer" .}}
    </div>
    {{end}}

    </main>

    <output id="loadingOverlay" class="loading-overlay d-none" aria-live="polite" aria-busy="true" aria-label="Running IP investigation">
        <div class="loading-content">
            <div class="loading-spinner">
                <i class="fas fa-route fa-spin"></i>
            </div>
            <h4 class="mt-4 mb-2">Investigating IP Relationship</h4>
            <p class="text-muted mb-0" id="loadingIP"></p>
            <div class="loading-elapsed mt-2">
                <span class="text-muted small" id="loadingTimer">0s</span>
            </div>
            <div class="loading-dots mt-2">
                <span></span><span></span><span></span>
            </div>
            <p class="text-muted small mt-3 mb-0" id="loadingNote" style="max-width: 440px; margin: 0 auto; opacity: 0; transition: opacity 0.8s;">
                We're checking reverse DNS, comparing against your domain's DNS records, verifying SPF authorization, querying Certificate Transparency logs, and performing ASN attribution. This typically takes 10&ndash;20 seconds.
            </p>
            <div class="loading-status mt-3">
                <span>Performing reverse DNS (PTR) lookup&hellip;</span>
                <span>Validating Forward-Confirmed reverse DNS (FCrDNS)&hellip;</span>
                <span>Comparing against domain A/AAAA records&hellip;</span>
                <span>Checking MX host resolution&hellip;</span>
                <span>Verifying nameserver IP addresses&hellip;</span>
                <span>Parsing SPF record for IP authorization&hellip;</span>
                <span>Walking SPF include chain&hellip;</span>
                <span>Querying Certificate Transparency logs&hellip;</span>
                <span>Looking up ASN and network attribution&hellip;</span>
                <span>Detecting CDN/edge network presence&hellip;</span>
                <span>Classifying IP-to-domain relationship&hellip;</span>
            </div>
        </div>
    </output>

    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script nonce="{{.CspNonce}}">
    (function() {
        var form = document.getElementById('investigateForm');
        if (!form) return;
        form.addEventListener('submit', function(e) {
            var domain = document.getElementById('domain');
            var ip = document.getElementById('ip_address');
            if (!domain || !ip || !domain.value.trim() || !ip.value.trim()) return;

            var overlay = document.getElementById('loadingOverlay');
            var loadingIP = document.getElementById('loadingIP');
            var loadingNote = document.getElementById('loadingNote');
            var loadingTimer = document.getElementById('loadingTimer');
            if (!overlay) return;

            if (loadingIP) loadingIP.textContent = ip.value.trim() + ' \u2194 ' + domain.value.trim();
            overlay.classList.remove('d-none');

            var startTime = Date.now();
            setInterval(function() {
                var elapsed = Math.floor((Date.now() - startTime) / 1000);
                if (loadingTimer) loadingTimer.textContent = elapsed + 's';
            }, 1000);

            setTimeout(function() {
                if (loadingNote) loadingNote.style.opacity = '1';
            }, 3000);

            var statusSpans = overlay.querySelectorAll('.loading-status span');
            if (statusSpans.length > 0) {
                var idx = 0;
                statusSpans[0].classList.add('active');
                setInterval(function() {
                    statusSpans[idx].classList.remove('active');
                    idx = (idx + 1) % statusSpans.length;
                    statusSpans[idx].classList.add('active');
                }, 2000);
            }

            var btn = document.getElementById('investigateBtn');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-route fa-spin me-2"></i>Investigating\u2026';
            }
        });
    })();
    </script>
</body>
</html>
