<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    {{template "head" .}}
    <title>Zone File Import — DNS Tool</title>
    <meta name="description" content="Upload a BIND zone file to compare against live DNS analysis and detect configuration drift.">
    <link rel="canonical" href="https://dnstool.it-help.tech/zone">
    {{template "critical_css" .}}
    {{template "head_css" .}}
</head>
<body>
    {{template "nav" .}}
    <main id="main-content">

    {{if .ShowForm}}
    <section class="hero-section">
        <div class="container">
            <div class="text-center hero-content">
                <div class="hero-badge mb-3">
                    <i class="fas fa-upload me-1"></i> Zone File Import
                </div>
                <h1 class="hero-title mb-3">Zone File Import</h1>
                <p class="hero-subtitle mx-auto mb-4">
                    Upload a BIND zone file to compare against the most recent live DNS analysis and detect configuration drift.
                </p>
            </div>

            {{template "flash_messages" .}}

            <div class="row justify-content-center">
                <div class="col-lg-7 col-xl-6">
                    <div class="card bg-dark border-secondary">
                        <div class="card-body p-4">
                            <div class="alert alert-warning mb-4" role="alert">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Sensitivity Notice:</strong> Zone files may contain internal infrastructure details. 
                                By default, uploaded files are analyzed but <strong>not retained</strong>. 
                                Check "Retain zone data" only if you want the file stored for future reference.
                            </div>

                            <form method="POST" action="/zone/upload" enctype="multipart/form-data" id="zoneUploadForm">
                                <input type="hidden" name="csrf_token" value="{{.CsrfToken}}">

                                <div class="mb-3">
                                    <label for="zone_file" class="form-label">
                                        <i class="fas fa-file me-1"></i> Zone File
                                    </label>
                                    <input type="file" class="form-control bg-dark text-light border-secondary" 
                                           id="zone_file" name="zone_file" accept=".txt,.zone,.db,.bind" required>
                                    <div class="form-text text-muted">
                                        BIND-format zone file, max 2 MB. Common extensions: .txt, .zone, .db
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="domain_override" class="form-label">
                                        <i class="fas fa-globe me-1"></i> Domain Override <span class="text-muted small">(optional)</span>
                                    </label>
                                    <input type="text" class="form-control bg-dark text-light border-secondary" 
                                           id="domain_override" name="domain_override" 
                                           placeholder="example.com"
                                           autocomplete="off">
                                    <div class="form-text text-muted">
                                        Override the $ORIGIN if your zone file does not include one, or uses a different origin.
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="retain" name="retain" value="1">
                                        <label class="form-check-label" for="retain">
                                            Retain zone data for future reference
                                        </label>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary w-100" id="uploadBtn">
                                    <i class="fas fa-upload me-2"></i> Upload and Analyze
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {{end}}

    {{if .ShowResults}}
    <section class="container mt-4 mb-5">
        <h2 class="mb-4"><i class="fas fa-file me-2"></i>Zone File Analysis</h2>

        <div class="card bg-dark border-secondary mb-4">
            <div class="card-header border-secondary">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>File Summary</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-dark table-sm mb-0">
                            <tr>
                                <td class="text-muted" style="width:40%">Filename</td>
                                <td>{{.Filename}}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Domain</td>
                                <td><strong class="text-info">{{.ParseResult.Domain}}</strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Records Parsed</td>
                                <td>{{.ParseResult.RecordCount}}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-dark table-sm mb-0">
                            <tr>
                                <td class="text-muted" style="width:40%">File Size</td>
                                <td>{{.FileSize}} bytes</td>
                            </tr>
                            <tr>
                                <td class="text-muted">SHA-256</td>
                                <td><code class="small">{{slice .ParseResult.SHA256 0 16}}…</code></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Retained</td>
                                <td>{{if .Retained}}<span class="text-success"><i class="fas fa-check me-1"></i>Yes</span>{{else}}<span class="text-muted">No</span>{{end}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        {{if .ParseResult.ParseErrors}}
        <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i><strong>Parse Warnings:</strong>
            <ul class="mb-0 mt-2">
            {{range .ParseResult.ParseErrors}}
                <li>{{.}}</li>
            {{end}}
            </ul>
        </div>
        {{end}}

        <div class="card bg-dark border-secondary mb-4">
            <div class="card-header border-secondary">
                <h5 class="mb-0"><i class="fas fa-list me-2"></i>Parsed Records</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-dark table-striped table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>TTL</th>
                                <th>Class</th>
                                <th>Type</th>
                                <th>Data</th>
                            </tr>
                        </thead>
                        <tbody>
                        {{range .ParseResult.Records}}
                            <tr>
                                <td><code>{{.Name}}</code></td>
                                <td>{{.TTL}}</td>
                                <td>{{.Class}}</td>
                                <td><span class="badge bg-info text-dark">{{.Type}}</span></td>
                                <td class="small"><code>{{.RData}}</code></td>
                            </tr>
                        {{end}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        {{if .DriftReport}}
        <div class="card bg-dark border-secondary mb-4">
            <div class="card-header border-secondary">
                <h5 class="mb-0">
                    <i class="fas fa-exchange-alt me-2"></i>Drift Report
                    {{if gt .DriftReport.TotalDrifts 0}}
                    <span class="badge bg-warning text-dark ms-2">{{.DriftReport.TotalDrifts}} difference{{if gt .DriftReport.TotalDrifts 1}}s{{end}}</span>
                    {{else}}
                    <span class="badge bg-success ms-2">No Drift Detected</span>
                    {{end}}
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="text-muted small">Zone File Records</div>
                        <div class="fs-5">{{.DriftReport.ZoneRecords}}</div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-muted small">Live DNS Records</div>
                        <div class="fs-5">{{.DriftReport.LiveRecords}}</div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-muted small">Compared Against</div>
                        <div class="fs-5">
                            {{if .LiveAnalysisID}}<a href="/analysis/{{.LiveAnalysisID}}" class="text-info">Analysis #{{.LiveAnalysisID}}</a>{{else}}N/A{{end}}
                        </div>
                    </div>
                </div>

                {{if gt (len .DriftReport.Added) 0}}
                <h6 class="text-warning mt-4 mb-2"><i class="fas fa-plus-circle me-1"></i>Added (In Zone, Not in Live DNS)</h6>
                <div class="table-responsive">
                    <table class="table table-dark table-sm">
                        <thead><tr><th>Name</th><th>Type</th><th>Zone Value</th><th>TTL</th><th>Description</th></tr></thead>
                        <tbody>
                        {{range .DriftReport.Added}}
                        <tr>
                            <td><code>{{.Name}}</code></td>
                            <td><span class="badge bg-info text-dark">{{.Type}}</span></td>
                            <td class="small"><code>{{.ZoneValue}}</code></td>
                            <td>{{.ZoneTTL}}</td>
                            <td class="small text-muted">{{.Description}}</td>
                        </tr>
                        {{end}}
                        </tbody>
                    </table>
                </div>
                {{end}}

                {{if gt (len .DriftReport.Missing) 0}}
                <h6 class="text-danger mt-4 mb-2"><i class="fas fa-minus-circle me-1"></i>Missing (In Live DNS, Not in Zone)</h6>
                <div class="table-responsive">
                    <table class="table table-dark table-sm">
                        <thead><tr><th>Name</th><th>Type</th><th>Live Value</th><th>TTL</th><th>Description</th></tr></thead>
                        <tbody>
                        {{range .DriftReport.Missing}}
                        <tr>
                            <td><code>{{.Name}}</code></td>
                            <td><span class="badge bg-info text-dark">{{.Type}}</span></td>
                            <td class="small"><code>{{.LiveValue}}</code></td>
                            <td>{{.LiveTTL}}</td>
                            <td class="small text-muted">{{.Description}}</td>
                        </tr>
                        {{end}}
                        </tbody>
                    </table>
                </div>
                {{end}}

                {{if gt (len .DriftReport.Changed) 0}}
                <h6 class="text-warning mt-4 mb-2"><i class="fas fa-exclamation-triangle me-1"></i>Changed (Value Differs)</h6>
                <div class="table-responsive">
                    <table class="table table-dark table-sm">
                        <thead><tr><th>Name</th><th>Type</th><th>Zone Value</th><th>Live Value</th><th>Description</th></tr></thead>
                        <tbody>
                        {{range .DriftReport.Changed}}
                        <tr>
                            <td><code>{{.Name}}</code></td>
                            <td><span class="badge bg-info text-dark">{{.Type}}</span></td>
                            <td class="small"><code>{{.ZoneValue}}</code></td>
                            <td class="small"><code>{{.LiveValue}}</code></td>
                            <td class="small text-muted">{{.Description}}</td>
                        </tr>
                        {{end}}
                        </tbody>
                    </table>
                </div>
                {{end}}

                {{if gt (len .DriftReport.TTLOnly) 0}}
                <h6 class="text-info mt-4 mb-2"><i class="fas fa-clock me-1"></i>TTL Only (Same Value, Different TTL)</h6>
                <div class="table-responsive">
                    <table class="table table-dark table-sm">
                        <thead><tr><th>Name</th><th>Type</th><th>Value</th><th>Zone TTL</th><th>Live TTL</th><th>Description</th></tr></thead>
                        <tbody>
                        {{range .DriftReport.TTLOnly}}
                        <tr>
                            <td><code>{{.Name}}</code></td>
                            <td><span class="badge bg-info text-dark">{{.Type}}</span></td>
                            <td class="small"><code>{{.ZoneValue}}</code></td>
                            <td>{{.ZoneTTL}}</td>
                            <td>{{.LiveTTL}}</td>
                            <td class="small text-muted">{{.Description}}</td>
                        </tr>
                        {{end}}
                        </tbody>
                    </table>
                </div>
                {{end}}

                {{if eq .DriftReport.TotalDrifts 0}}
                <div class="text-center py-4">
                    <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
                    <p class="text-muted">Zone file is consistent with live DNS — no drift detected.</p>
                </div>
                {{end}}
            </div>
        </div>
        {{else}}
        <div class="alert alert-info" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            No previous live DNS analysis found for <strong>{{.ParseResult.Domain}}</strong>. 
            <a href="/analyze?domain={{.ParseResult.Domain}}" class="alert-link">Run a live analysis</a> first, then re-upload the zone file to generate a drift report.
        </div>
        {{end}}

        <div class="text-center mt-4">
            <a href="/zone" class="btn btn-outline-secondary me-2"><i class="fas fa-upload me-1"></i>Upload Another File</a>
            <a href="/analyze?domain={{.ParseResult.Domain}}" class="btn btn-outline-info"><i class="fas fa-search me-1"></i>Analyze {{.ParseResult.Domain}}</a>
        </div>
    </section>
    {{end}}

    </main>
    {{template "footer" .}}
    {{template "scripts" .}}
</body>
</html>
