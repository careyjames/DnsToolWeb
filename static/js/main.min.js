function startStatusCycle(e){const t=document.getElementById("loadingTimer"),n=document.getElementById("loadingNote"),s=Date.now();t&&setInterval(function(){const e=Math.floor((Date.now()-s)/1e3);t.textContent=e+"s"},1e3),n&&setTimeout(function(){n.style.opacity="1"},6e3);const o=e.querySelectorAll(".scan-phase");if(0===o.length)return;o.forEach(function(e,t){const n=Number.parseInt(e.dataset.delay,10)||0;setTimeout(function(){e.classList.add("visible","active-phase")},n);const s=n+1800+1200*Math.random();t!==o.length-1&&setTimeout(function(){e.classList.remove("active-phase"),e.classList.add("done");const t=e.querySelector(".scan-icon");t&&(t.className="fas fa-check-circle scan-icon")},s)})}function isValidDomain(e){if(!e)return!1;const t=e.replace(/\.$/,"");if(t.length>253||0===t.length)return!1;const n=t.split(".");if(n.length<2)return!1;for(const e of n){if(0===e.length||e.length>63)return!1;if(e.startsWith("-")||e.endsWith("-"))return!1}const s=n[n.length-1];if(/^\d+$/.test(s))return!1;if(!/[^\u0020-\u007F]/.test(t))for(const e of n)if(!/^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$/.test(e))return!1;return!0}function resetCopyBtn(e){e.innerHTML='<i class="fas fa-copy"></i>',e.classList.remove("copied")}function handleCopyResult(e,t){e.innerHTML=t?'<i class="fas fa-check"></i>':'<i class="fas fa-times"></i>',t&&e.classList.add("copied"),setTimeout(function(){resetCopyBtn(e)},1500)}function createCopyHandler(e,t){return function(n){n.stopPropagation();let s="";e.childNodes.forEach(function(e){e===t||e.classList?.contains("copy-btn")||(s+=e.textContent)}),s=s.trim(),navigator.clipboard.writeText(s).then(function(){handleCopyResult(t,!0)}).catch(function(){handleCopyResult(t,!1)})}}"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(function(){}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("domainForm"),t=document.getElementById("domain"),n=document.getElementById("analyzeBtn");e&&t&&n&&(t.addEventListener("input",function(){const e=this.value.trim(),t=""===e||isValidDomain(e);e&&!t?(this.classList.add("is-invalid"),n.disabled=!0):(this.classList.remove("is-invalid"),n.disabled=!1)}),e.addEventListener("submit",function(e){const s=t.value.trim().toLowerCase();if(t.value=s,!s)return e.preventDefault(),void t.classList.add("is-invalid");if(!isValidDomain(s))return e.preventDefault(),void t.classList.add("is-invalid");const o=document.getElementById("loadingOverlay"),a=document.getElementById("loadingDomain");o&&(a&&(a.textContent=s),o.classList.remove("d-none"),startStatusCycle(o)),n.textContent="";const i=document.createElement("i");i.className="fas fa-spinner fa-spin me-2",n.appendChild(i),n.appendChild(document.createTextNode("Analyzing...")),n.disabled=!0,document.body.classList.add("loading")}),t.addEventListener("focus",function(){this.classList.remove("is-invalid")})),document.querySelectorAll(".alert-dismissible:not(.alert-persistent)").forEach(function(e){setTimeout(function(){bootstrap.Alert.getOrCreateInstance(e).close()},5e3)}),document.querySelectorAll(".alert-dismissible .btn-close").forEach(function(e){e.addEventListener("click",function(){const t=e.closest(".alert");if(t)try{bootstrap.Alert.getOrCreateInstance(t).close()}catch(e){console.warn("Bootstrap alert fallback:",e.message),t.classList.remove("show"),t.addEventListener("transitionend",function(){t.remove()}),setTimeout(function(){t.remove()},300)}})}),document.querySelectorAll('a[href^="#"]').forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.href.substring(this.href.indexOf("#")));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})}),document.querySelectorAll(".code-block").forEach(function(e){e.style.cursor="pointer",e.title="Click to copy";const t=document.createElement("button");t.type="button",t.className="copy-btn",t.setAttribute("aria-label","Copy to clipboard"),t.innerHTML='<i class="fas fa-copy"></i>',e.appendChild(t);const n=createCopyHandler(e,t);t.addEventListener("click",n),e.addEventListener("click",n)})});const allFixesCollapse=document.getElementById("allFixesCollapse");if(allFixesCollapse){const e=document.querySelector('[data-bs-target="#allFixesCollapse"]');if(e){const t=Array.from(e.childNodes).map(function(e){return e.cloneNode(!0)});allFixesCollapse.addEventListener("shown.bs.collapse",function(){e.textContent="";const t=document.createElement("i");t.className="fas fa-chevron-up me-1",e.appendChild(t),e.appendChild(document.createTextNode("Show fewer"))}),allFixesCollapse.addEventListener("hidden.bs.collapse",function(){e.textContent="",t.forEach(function(t){e.appendChild(t.cloneNode(!0))})})}}function loadDNSHistory(e){const t=document.getElementById("dns-history-btn");t&&(t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin me-1"></i>Loading history…',fetch("/api/dns-history?domain="+encodeURIComponent(e)).then(function(e){return e.json()}).then(function(e){if(!e||"unavailable"===e.status||"error"===e.status||!e.available)return void(t.closest(".dns-history-load-wrapper").style.display="none");const n=document.getElementById("dns-history-section"),s=document.getElementById("dns-history-body"),o=document.getElementById("dns-history-source");if(!n||!s)return;o.textContent="Source: "+(e.source||"SecurityTrails");const a=e.changes||[];if(0===a.length)s.innerHTML='<p class="text-muted mb-0"><i class="fas fa-check-circle text-success me-1"></i>No DNS record changes detected in available history. A, AAAA, MX, and NS records for this domain have remained stable.</p>';else{let e='<div class="table-responsive"><table class="table table-sm table-striped mb-0"><thead><tr><th style="width:80px">Date</th><th style="width:60px">Type</th><th style="width:70px">Action</th><th>Value</th><th>Organization</th><th>Timeline</th></tr></thead><tbody>';a.forEach(function(t){let n="secondary";"A"===t.record_type||"AAAA"===t.record_type?n="primary":"MX"===t.record_type?n="success":"NS"===t.record_type&&(n="info");const s="added"===t.action?'<span class="text-success"><i class="fas fa-plus-circle me-1"></i>Added</span>':'<span class="text-danger"><i class="fas fa-minus-circle me-1"></i>Removed</span>';e+='<tr><td><code class="text-muted" style="font-size:0.8em">'+(t.date||"")+'</code></td><td><span class="badge bg-'+n+'">'+(t.record_type||"")+"</span></td><td>"+s+'</td><td><code style="font-size:0.85em">'+(t.value||"")+'</code></td><td><span class="text-muted">'+(t.org||"—")+'</span></td><td><span class="text-muted" style="font-size:0.85em">'+(t.description||"")+"</span></td></tr>"}),e+="</tbody></table></div>",s.innerHTML=e}t.closest(".dns-history-load-wrapper").style.display="none",n.style.display=""}).catch(function(){t.closest(".dns-history-load-wrapper").style.display="none"}))}